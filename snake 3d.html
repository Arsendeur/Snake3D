<!DOCTYPE html>
<html>
	<head>
		<title>WebGL/Three.js</title>
		<script src="three.min.js"></script>
		
	</head>
	<body>
		<h1>Scene 3D</h1>
		<canvas id="3d" style="border:1px"></canvas>
		<script>
            var direction = "left";
            var tail;
            var square = 100;
            var espace = 5;
            var tailleCubeConteneur = 1200;
            var tailleCamera = 900;
            var snake = Array();
			var scene = new THREE.Scene();
			var mesh1 = new THREE.Mesh(
                new THREE.CubeGeometry(square, square, square),
				new THREE.MeshLambertMaterial(
					{ color:0x0000ff, wireframe: false /*tout ceci est du JSON*/}
				)
			);
            mesh1.position.z = 100;
			var mesh2 = new THREE.Mesh(
                new THREE.CubeGeometry(square, square, square),
				new THREE.MeshLambertMaterial(
					{ color:0xCC0000, wireframe: false /*tout ceci est du JSON*/}
				)
			);
            mesh2.position.z = -5;
			var mesh3 = new THREE.Mesh(
                new THREE.CubeGeometry(square, square, square),
				new THREE.MeshLambertMaterial(
					{ color:0x33FF33, wireframe: false /*tout ceci est du JSON*/}
				)
			);
            mesh3.position.z = -110;

            snake.push(mesh1, mesh2, mesh3);

			var cubeConteneur = new THREE.Mesh(
                new THREE.CubeGeometry(tailleCubeConteneur, tailleCubeConteneur, tailleCubeConteneur),
				new THREE.MeshLambertMaterial(
					{ color:0xCC0000, wireframe: true /*tout ceci est du JSON*/}
				)
            );


			scene.add(mesh3);
			scene.add(mesh1);
			scene.add(mesh2);
			scene.add(cubeConteneur);
			scene.add(new THREE.AmbientLight(0x222222));
			
			var lightGLobal = new THREE.PointLight(0xffffff);
			lightGLobal.position.y = 1000;
			scene.add(lightGLobal);

			var lightCenter = new THREE.PointLight(/*0xff00ff*/0xc92835);
			scene.add(lightCenter);


			//rendu
	    	var renderer = new THREE.WebGLRenderer(
	        	{canvas:document.getElementById("3d")}
	    	);
	    	var camera = new THREE.PerspectiveCamera(
	    		75 /*fov*/, 4/3 /*ratio*/, 1 /*near*/, 10000 /*far*/
	    	);
	    	camera.position.set(tailleCamera, tailleCamera, tailleCamera);
	    	camera.lookAt(new THREE.Vector3(0,0,0));

	    	renderer.setSize(640,480);
	    	/*renderer.render(scene,camera);*/
	    	animate();
            var exempleInterval = setInterval("animate()", 50);

            function horsChamp(cube)
            {
                console.log(cube.position.z);
                console.log(cubeConteneur.position.z);
                if (cube.position.z > (cubeConteneur.position.z + tailleCubeConteneur))
                    cube.position.z = cubeConteneur.position.z - tailleCubeConteneur;

                if (cube.position.z < (cubeConteneur.position.z - tailleCubeConteneur ))
                    cube.position.z = cubeConteneur.position.z + tailleCubeConteneur;

                if (cube.position.y > (cubeConteneur.position.y + tailleCubeConteneur))
                    cube.position.y = cubeConteneur.position.y - tailleCubeConteneur;

                if (cube.position.y < (cubeConteneur.position.y - tailleCubeConteneur ))
                    cube.position.y = cubeConteneur.position.y + tailleCubeConteneur;
            }

	    	function animate(){

                document.onkeydown = changeDirection;
                if(direction == "left")
                {
                    tail = snake.pop();
                    head = snake[0];
                    horsChamp(head);
                    tail.position.x = head.position.x;
                    tail.position.z = head.position.z;
                    tail.position.y = head.position.y;
                    tail.position.z += (square + espace);
                    //horsChamp(tail);

                    snake.unshift(tail);
                }

                if(direction == "top")
                {
                    tail = snake.pop();
                    head = snake[0];
                    horsChamp(head);
                    tail.position.x = head.position.x;
                    tail.position.z = head.position.z;
                    tail.position.y = head.position.y;
                    tail.position.y += (square + espace);
                    snake.unshift(tail);
                }

                if(direction == "right")
                {
                    tail = snake.pop();
                    head = snake[0];
                    horsChamp(head);
                    tail.position.x = head.position.x;
                    tail.position.z = head.position.z;
                    tail.position.y = head.position.y;
                    tail.position.z -= (square - espace);
                    snake.unshift(tail);
                }

                if(direction == "bottom")
                {
                    tail = snake.pop();
                    head = snake[0];
                    horsChamp(head);
                    tail.position.x = head.position.x;
                    tail.position.z = head.position.z;
                    tail.position.y = head.position.y;
                    tail.position.y -= (square - espace);
                    snake.unshift(tail);
                }

                if(direction == "devant")
                {
                    tail = snake.pop();
                    head = snake[0];
                    tail.position.x = head.position.x;
                    tail.position.z = head.position.z;
                    tail.position.y = head.position.y;
                    tail.position.x -= (square - espace);
                    snake.unshift(tail);
                }

                if(direction == "derriere")
                {
                    tail = snake.pop();
                    head = snake[0];
                    tail.position.x = head.position.x;
                    tail.position.z = head.position.z;
                    tail.position.y = head.position.y;
                    tail.position.x += (square + espace);
                    snake.unshift(tail);
                }
	    		renderer.render(scene,camera);


                function changeDirection(event) {
                    if (event.keyCode == 37)
                        direction = "left";

                    if (event.keyCode == 38)
                        direction = "top";

                    if (event.keyCode == 39)
                        direction = "right";

                    if (event.keyCode == 40)
                        direction = "bottom";

                    if (event.keyCode == 33)
                        direction = "devant";

                    if (event.keyCode == 34)
                        direction = "derriere";
                }

            }

		</script>
	</body>
</html>
